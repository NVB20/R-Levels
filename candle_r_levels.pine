//@version=6
indicator("R-Levels", overlay=true)

// Input bar index (simulating "click" on a candle)
targetBarIndex = input.int(0, "Select Bar Index", minval=0)
showPrices = input.bool(true, "Show Prices on Labels")  // Toggle price labels
showBarIndexLabel = input.bool(true, "Show Bar Index Label")  // Toggle bar index label

// Show bar index label only if toggled on
if showBarIndexLabel
    label.new(bar_index, high, text=str.tostring(bar_index), style=label.style_label_down, size=size.small)

var line entryLine = na
var line stopLine = na
var line r3Line = na
var line r6Line = na

// Candle levels when selecting a new bar
if (bar_index == targetBarIndex)
    // Candle values
    entry = high + 0.01
    stop = low - 0.01
    tradeRisk = entry - stop
    r3 = entry + tradeRisk * 3
    r6 = entry + tradeRisk * 6

    // Update existing lines or create them if not already created
    if (na(entryLine))
        entryLine := line.new(x1=bar_index, y1=entry, x2=bar_index + 5, y2=entry, color=color.green, width=2)
    else
        line.set_xy1(entryLine, bar_index, entry)
        line.set_xy2(entryLine, bar_index + 5, entry)

    if (na(stopLine))
        stopLine := line.new(x1=bar_index, y1=stop, x2=bar_index + 5, y2=stop, color=color.red, width=2)
    else
        line.set_xy1(stopLine, bar_index, stop)
        line.set_xy2(stopLine, bar_index + 5, stop)

    if (na(r3Line))
        r3Line := line.new(x1=bar_index, y1=r3, x2=bar_index + 5, y2=r3, color=color.blue, width=2)
    else
        line.set_xy1(r3Line, bar_index, r3)
        line.set_xy2(r3Line, bar_index + 5, r3)

    if (na(r6Line))
        r6Line := line.new(x1=bar_index, y1=r6, x2=bar_index + 5, y2=r6, color=color.purple, width=2)
    else
        line.set_xy1(r6Line, bar_index, r6)
        line.set_xy2(r6Line, bar_index + 5, r6)

    // Text formatting based on toggle
    entryText = showPrices ? "Entry: " + str.tostring(entry, format.mintick) : "Entry"
    stopText  = showPrices ? "Stop: " + str.tostring(stop, format.mintick) : "Stop"
    r3Text    = showPrices ? "3R: " + str.tostring(r3, format.mintick) : "3R"
    r6Text    = showPrices ? "6R: " + str.tostring(r6, format.mintick) : "6R"

    // Labels with conditional price display
    label.new(x=bar_index + 5, y=entry, text=entryText, style=label.style_label_left, color=color.green, textcolor=color.white)
    label.new(x=bar_index + 5, y=stop, text=stopText, style=label.style_label_left, color=color.red, textcolor=color.white)
    label.new(x=bar_index + 5, y=r3, text=r3Text, style=label.style_label_left, color=color.blue, textcolor=color.white)
    label.new(x=bar_index + 5, y=r6, text=r6Text, style=label.style_label_left, color=color.purple, textcolor=color.white)
